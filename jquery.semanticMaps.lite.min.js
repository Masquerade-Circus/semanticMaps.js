/*
 * jQuery semanticMaps
 * Plugin creado por Masquerade Circus
 * http://masquerade-circus.net
 * Versión 0.4
 * https://github.com/Masquerade-Circus/semanticMaps.js
 */
!function(e){"use strict";var t=!1;window.googlemapsloaded=function(){t=!0},e.extend(e.fn,{semanticMaps:function(){function o(e){var t=document.getElementsByTagName("script")[0],o=document.createElement("script"),n=e.data("apikey")||"";""!==n&&(n="&key="+n),o.type="text/javascript",o.src="http://maps.googleapis.com/maps/api/js?callback=googlemapsloaded&libraries=places"+n,t.parentNode.insertBefore(o,t),a()}function a(){function o(t,o){var a,n=e('<input id="pac-input" class="form-control" type="text" placeholder="Buscar en los alrededores" style="max-width: 50%">')[0],s=[];t.controls[o.maps.ControlPosition.TOP_CENTER].push(n),a=new o.maps.places.SearchBox(n),o.maps.event.addListener(a,"places_changed",function(){var e,n,i,l,c,d,m=a.getPlaces();if(m.length>0){for(e=0;i=s[e];e++)i.setMap(null);for(s=[],n=new o.maps.LatLngBounds,e=0;l=m[e];e++)c={map:t,title:l.name,animation:o.maps.Animation.DROP,position:l.geometry.location},l.photos&&(c.icon=l.photos[0].getUrl({maxWidth:35,maxHeight:35})),i=new o.maps.Marker(c),s.push(i),n.extend(c.position),d="",l.photos&&(d+='<img src="'+l.photos[0].getUrl({maxWidth:150,maxHeight:100})+'" style="display: block; float: left; margin: 0 1em 1em 0">'),d+="<b>Nombre:</b> "+l.name+"<br><b>Dirección:</b> "+l.formatted_address+"<br>",l.types&&l.types.length>0&&(d+="<b>Tipo de establecimiento:</b> "+l.types.join(",")+"<br>"),l.website&&(d+="<b>Sitio web:</b> "+l.website+"<br>"),l.formatted_phone_number&&(d+="<b>Teléfono:</b> "+l.formatted_phone_number+"<br>"),l.opening_hours&&(d+="<b>Horarios:</b> "+l.opening_hours.weekday_text.join(", ")+"<br>",d+="<b>Abierto ahora:</b> "+(l.opening_hours.open_now?"Sí":"No")+"<br>"),l.rating&&(d+="<b>Rating:</b> "+l.rating+"<br>"),p(t,i,d);for(e in r)n.extend(r[e].position);t.fitBounds(n)}}),o.maps.event.addListener(t,"bounds_changed",function(){a.setBounds(t.getBounds())})}if("object"==typeof google&&"object"==typeof google.maps&&t){for(n=new google.maps.Map(c[0],{scrollwheel:!1,center:new google.maps.LatLng(d.lat,d.lon),zoom:d.zoom,mapTypeId:google.maps.MapTypeId.ROADMAP,styles:m}),l=function(e,t,o,a,n,s,l,c){i=r.push(new google.maps.Marker({map:e,position:new google.maps.LatLng(t,o),icon:a,optimized:!1,animation:google.maps.Animation.DROP,title:n})),p(e,r[i-1],s,l,c)},p=function(e,t,o,a,n){google.maps.event.addListener(t,"click",function(){if(e.setCenter(t.getPosition()),o.trim().length>0&&(s.open(e,t),s.setContent(o)),a&&a.length>0){var n=Function("marker","infowindow",a);n.call(e,t,s)}}),n&&new google.maps.event.trigger(t,"click")},s=new google.maps.InfoWindow({content:""}),r=[],i=0;i<d.markers.length;i++){var g=d.markers.eq(i),u=g.data("lat"),b=g.data("lon"),f=g.data("icon"),h=g.attr("title"),y=g.html(),w=g.data("function"),x=g.data("open")||!1;l(n,u,b,f,h,y,w,x)}e(window).resize(function(){n.panTo(new google.maps.LatLng(d.lat,d.lon))}),d.searchBox!==!1&&o(n,google)}else setTimeout(function(){a()},100)}var n,s,r,i,l,p,c=this,d={zoom:c.data("zoom")||16,lat:c.data("lat")||0,lon:c.data("lon")||0,landscape:c.data("landscape")||"E9E5DC",road:c.data("road")||"FFFFFF",water:c.data("water")||"8CB5FD",text:c.data("text")||"32281E",poi:c.data("poi")||"F4F3EB",markers:e(".marker",c),searchBox:c.data("searchbox")||!1},m=[];return d.landscape!=[]._&&m.push({featureType:"landscape",stylers:[{color:"#"+d.landscape}]}),d.road!=[]._&&m.push({featureType:"road",stylers:[{color:"#"+d.road}]}),d.text!=[]._&&m.push({featureType:"water",stylers:[{color:"#"+d.water}]}),d.water!=[]._&&m.push({elementType:"labels.text",stylers:[{saturation:1},{weight:.4},{color:"#"+d.text}]}),d.poi!=[]._&&m.push({featureType:"poi",elementType:"geometry",stylers:[{color:"#"+d.poi}]}),"object"==typeof google?function(){t=!0,a()}():o(this),{map:c[0],addMarker:function(t){var o=null,t=e.extend({lat:o,lon:o,icon:o,title:o,content:o,callback:o},t);l(n,t.lat,t.lon,t.icon,t.title,t.content,t.callback)}}}})}(jQuery);
