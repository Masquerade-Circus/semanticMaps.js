/*
 * jQuery semanticMaps
 * Plugin creado por Masquerade Circus
 * http://masquerade-circus.net
 * Versión 0.3
 * https://github.com/Masquerade-Circus/semanticMaps.js
 */
!function(e){"use strict";var t=!1;window.googlemapsloaded=function(){t=!0},e.extend(e.fn,{semanticMaps:function(){function o(){var e=document.createElement("script");e.type="text/javascript",e.src="http://maps.googleapis.com/maps/api/js?&sensor=false&callback=googlemapsloaded&libraries=places";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t),a()}function a(){function o(t,o){var a,n=e('<input id="pac-input" class="form-control" type="text" placeholder="Buscar en los alrededores" style="max-width: 50%">')[0],r=[];t.controls[o.maps.ControlPosition.TOP_CENTER].push(n),a=new o.maps.places.SearchBox(n),o.maps.event.addListener(a,"places_changed",function(){var e,n,i,l,c=a.getPlaces();if(c.length>0){for(e=0;i=r[e];e++)i.setMap(null);for(r=[],n=new o.maps.LatLngBounds,e=0;l=c[e];e++){var m={map:t,title:l.name,animation:o.maps.Animation.DROP,position:l.geometry.location};l.photos&&(m.icon=l.photos[0].getUrl({maxWidth:35,maxHeight:35})),i=new o.maps.Marker(m),r.push(i),n.extend(m.position);var d="";l.photos&&(d+='<img src="'+l.photos[0].getUrl({maxWidth:150,maxHeight:100})+'" style="display: block; float: left; margin: 0 1em 1em 0">'),d+="<b>Nombre:</b> "+l.name+"<br><b>Dirección:</b> "+l.formatted_address+"<br>",l.types&&l.types.length>0&&(d+="<b>Tipo de establecimiento:</b> "+l.types.join(",")+"<br>"),l.website&&(d+="<b>Sitio web:</b> "+l.website+"<br>"),l.formatted_phone_number&&(d+="<b>Teléfono:</b> "+l.formatted_phone_number+"<br>"),l.opening_hours&&(d+="<b>Horarios:</b> "+l.opening_hours.weekday_text.join(", ")+"<br>",d+="<b>Abierto ahora:</b> "+(l.opening_hours.open_now?"Sí":"No")+"<br>"),l.rating&&(d+="<b>Rating:</b> "+l.rating+"<br>"),p(t,i,d)}for(e in s)n.extend(s[e].position);t.fitBounds(n)}}),o.maps.event.addListener(t,"bounds_changed",function(){a.setBounds(t.getBounds())})}if("object"==typeof google&&"object"==typeof google.maps&&t){for(n=new google.maps.Map(c[0],{scrollwheel:!1,center:new google.maps.LatLng(m.lat,m.lon),zoom:m.zoom,mapTypeId:google.maps.MapTypeId.ROADMAP,styles:d}),l=function(e,t,o,a,n,r,l){i=s.push(new google.maps.Marker({map:e,position:new google.maps.LatLng(t,o),icon:a,optimized:!1,animation:google.maps.Animation.DROP,title:n})),p(e,s[i-1],r,l)},p=function(e,t,o,a){google.maps.event.addListener(t,"click",function(){if(e.setCenter(t.getPosition()),o.trim().length>0&&(r.open(e,t),r.setContent(o)),a&&a.length>0){var n=Function("marker","infowindow",a);n.call(e,t,r)}})},r=new google.maps.InfoWindow({content:""}),s=[],i=0;i<m.markers.length;i++){var g=m.markers.eq(i),u=g.data("lat"),b=g.data("lon"),f=g.data("icon"),h=g.attr("title"),y=g.html(),w=g.data("function");l(n,u,b,f,h,y,w)}e(window).resize(function(){n.panTo(new google.maps.LatLng(m.lat,m.lon))}),0!=m.searchBox&&o(n,google)}else setTimeout(function(){a()},100)}var n,r,s,i,l,p,c=this,m={zoom:c.data("zoom")||16,lat:c.data("lat")||0,lon:c.data("lon")||0,landscape:c.data("landscape")||"E9E5DC",road:c.data("road")||"FFFFFF",water:c.data("water")||"8CB5FD",text:c.data("text")||"32281E",poi:c.data("poi")||"F4F3EB",markers:e(".marker",c),searchBox:c.data("searchbox")||!1},d=[];return m.landscape!=[]._&&d.push({featureType:"landscape",stylers:[{color:"#"+m.landscape}]}),m.road!=[]._&&d.push({featureType:"road",stylers:[{color:"#"+m.road}]}),m.text!=[]._&&d.push({featureType:"water",stylers:[{color:"#"+m.water}]}),m.water!=[]._&&d.push({elementType:"labels.text",stylers:[{saturation:1},{weight:.4},{color:"#"+m.text}]}),m.poi!=[]._&&d.push({featureType:"poi",elementType:"geometry",stylers:[{color:"#"+m.poi}]}),"object"==typeof google?function(){t=!0,a()}():o(),{map:c[0],addMarker:function(t){var o=null,t=e.extend({lat:o,lon:o,icon:o,title:o,content:o,callback:o},t);l(n,t.lat,t.lon,t.icon,t.title,t.content,t.callback)}}}})}(jQuery);
